{% extends 'base.html' %}
{% block title %}
Dashboard
{% endblock %}
{% block head %}
<head>
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
{% endblock %}
{% block body %}
<body>
  
  <main role="main" class="col-md-9 ml-sm-auto col-lg-12 px-4">
  
    <h1> User Dashboard - {{ current_user.username }} </h1>
    <hr>
  
    <div class="row">
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Top Ten Subreddits</h5> <!--One of Grace/Lydon's Chart should replace this-->
              <ol class="dumblist">
                  <li><a href="/subreddit/stopdrinking">stopdrinking</a></li>
                  <li><a href="/subreddit/serviceadvisors">serviceadvisors</a></li>
                  <li><a href="/subreddit/crochet">crochet</a></li>
                  <li><a href="/subreddit/datingover30">datingoverforty</a></li>
                  <li><a href="/subreddit/Justrolledintotheshop">Justrolledintotheshop</a></li>
                  <li><a href="/subreddit/OkCupid">OkCupid</a></li>
                  <li><a href="/subreddit/antiwork">antiwork</a></li>
                  <li><a href="/subreddit/arbedeenwa">arbedeenwa</a></li>
                  <li><a href="/subreddit/FriendsOver40">FriendsOver40</a></li>
                  <li><a href="/subreddit/farcry">farcry</a></li>
              </ol>              
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Basic info</h5>
              <canvas id="upvoteSubreddits" width="300" height="300"></canvas> 
              comment karma. post karma. account age. account suspended?
            </div>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Three</h5>
              <canvas id="pieChart1" style="width:100%; max-width: 10em;"></canvas>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Weekly Post Activity</h5>
              <canvas id="myChart" width="300" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>
  
      <div class="row">
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Comment Stats</h5>
              <p class="card-text">Average Comment Length: &emsp;<strong>{{ avgStats[0] }} (Median: {{ avgStats[1] }})</strong></p>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Main Recovery Subreddit</h5>
              <div></div>
              <p class="card-text"></p>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Seven</h5>
              <p class="card-text">Donec nec justo eget felis facilisis fermentum. Aliquam porttitor mauris sit amet orci. Aenean dignissim pellentesque felis.</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Eight</h5>
              <p class="card-text">Donec nec justo eget felis facilisis fermentum. Aliquam porttitor mauris sit amet orci. Aenean dignissim pellentesque felis.</p>
            </div>
          </div>
        </div>
      </div>      
  </main>
  </body>
{% endblock %}
{% block scripts %}
<!-- Import javascript functions (should be able to add to existing route)-->
<script type="text/javascript"
         src="{{ url_for('static', filename='dashb.js') }}"></script>

<script type=text/javascript>
    var dict = JSON.parse('{{  jsdict  | tojson | safe  }}')
    setupTopSubs(dict)
    var topSubs = JSON.parse('{{  topSubs[0]  | tojson | safe  }}')
    setupSubPieChart(topSubs)
</script>

<script>
const canvas = document.getElementById('upvoteSubreddits');
const ctx = canvas.getContext('2d');
const config = {
type: 'bar',
data: {
    labels: [
        {% for item in range(10) %}
            "{{ li[item] }}",
        {% endfor %}
    ],
    datasets: [{
        label: '# of upvoted posts',
        data: [
            {% for item in range(10) %}
                { subnames: '{{ li[item] }}', counts: {{ upvoteCounts[item] }}, links: "/subreddit/{{ li[item] }}"}, // format as 1 dictionary
            {% endfor %}
        ],
        backgroundColor: [
            'rgba(255, 99, 132, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 159, 64, 0.2)'
        ],
        borderColor: [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)'
        ],
        borderWidth: 1
    }]
},
options: {
    parsing: {
      xAxisKey: 'subnames',
      yAxisKey: 'counts'
    },
    scales: {
        y: {
            beginAtZero: true
        }
    }
}
};

const upvoteSubreddits= new Chart(ctx,  config);

//Makes barchart clickable
function clickHandler(click){
  const points = upvoteSubreddits.getElementsAtEventForMode(click, 'nearest', {intersect: true}, true);
  if (points.length) {
    const firstPoint = points[0];
    const value = upvoteSubreddits.data.datasets[firstPoint.datasetIndex].data[firstPoint.index];
    console.log(value.links)
    window.open(value.links);
  }
}
canvas.onclick = clickHandler;

</script>

{% endblock %}